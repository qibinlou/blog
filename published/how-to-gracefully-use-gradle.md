---
description: æœ¬æ–‡å°†åŸºäºGradle 5.5ä»‹ç»å‡ ä¸ªéå¸¸å®ç”¨ä½†é²œä¸ºäººçŸ¥çš„Gradleä½¿ç”¨æŠ€å·§ï¼Œå¸®åŠ©è¯»è€…ä¼˜é›…åœ°ä½¿ç”¨Gradleã€‚
---

# å¦‚ä½•ä¼˜é›…åœ°ä½¿ç”¨Gradle

## å¦‚ä½•ä¼˜é›…åœ°ä½¿ç”¨Gradle

Gradleæ˜¯ä¸€ä¸ªåŸºäºApache Antå’ŒApache Mavenæ¦‚å¿µçš„JVMé¡¹ç›®è‡ªåŠ¨åŒ–å»ºæ„å·¥å…·ã€‚ æœ‰åˆ«äºä¼ ç»Ÿçš„ä¸å¿å’è¯»çš„XMLé¡¹ç›®è®¾ç½®è¯­è¨€ï¼Œå®ƒä½¿ç”¨åŸºäºGroovyæˆ–è€…Kotlinçš„DSL\(é¢†åŸŸä¸“ç”¨è¯­è¨€\)æ¥é…ç½®é¡¹ç›®æ„å»ºæµç¨‹ï¼Œå¤§å¤§æé«˜äº†å¯è¯»æ€§å’Œæ˜“ç”¨æ€§ã€‚Spring Frameworkã€Hibernateç­‰è‘—åçš„å¼€æºæ¡†æ¶éƒ½åœ¨ä½¿ç”¨Gradleï¼Œå½“ç„¶è¿˜åŒ…æ‹¬Gradleæœ¬èº«ã€‚

å½“ç„¶Gradleæœ¬èº«ä¹Ÿæ˜¯æœ‰å­¦ä¹ æ›²çº¿çš„ï¼Œå¾ˆå¤šå¼€å‘è€…å¯¹å…¶çš„ç†è§£å’Œä½¿ç”¨å¯èƒ½åªåœç•™åœ¨`gradle test`å’Œ`gradle build`ä¸Šã€‚éšç€é¡¹ç›®ä»£ç çš„å¢åŠ ï¼Œé¡¹ç›®ä¾èµ–ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè‡ªå®šä¹‰çš„æ„å»ºæ­¥éª¤ä¹Ÿå¼€å§‹å‡ºç°ï¼Œæ•´ä¸ªé¡¹ç›®çš„æ„å»ºé€Ÿåº¦æ¸æ¸å˜æ…¢ï¼Œè¿›è€Œä½¿å¾—æŒç»­é›†æˆçš„é€Ÿåº¦ä¹Ÿç›¸ç»§å˜æ…¢ã€‚

æœ¬æ–‡å°†åŸºäºGradle 5.5ä»‹ç»å‡ ä¸ªéå¸¸å®ç”¨ä½†é²œä¸ºäººçŸ¥çš„Gradleä½¿ç”¨æŠ€å·§ï¼Œå¸®åŠ©è¯»è€…ä¼˜é›…åœ°ä½¿ç”¨Gradleã€‚

### ä½¿ç”¨Gradle Wrapper

Gradle Wrapperæ˜¯å®˜æ–¹æ¨èçš„ä½¿ç”¨Gradleçš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ç®€å•åœ°å£°æ˜è¦ä½¿ç”¨çš„Gradleçš„ç‰ˆæœ¬ï¼Œç„¶ååœ¨é¡¹ç›®æ„å»ºä¸­ä½¿ç”¨é‚£ä¸ªæŒ‡å®šçš„ç‰ˆæœ¬æ¥è·‘å„ä¸ªæ„å»ºä»»åŠ¡ã€‚è¿™æ ·ï¼Œä¸ç®¡ä½ ç”¨çš„æ˜¯å‘½ä»¤è¡Œè¿˜æ˜¯IDEï¼Œä¸ç®¡ä½ ç”¨çš„æ˜¯Windowsè¿˜æ˜¯Linux, ä½ ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå‘½ä»¤å’Œç‰ˆæœ¬ï¼Œæ¯”å¦‚`./gradlew build`ï¼Œæ­¤å¤„`./gradlew` å³æ˜¯æ‰€è¯´çš„Gradle Wrapperã€‚

ç”ŸæˆGradle Wrapperï¼Œä½ åªéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ`gradle wrapper --gradle-version 5.4.1`, ä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚åˆä½ çš„gradle-versionã€‚

### --parallel

éšç€é¡¹ç›®çš„å‘å±•ï¼Œäº§å“ä»£ç å’Œæµ‹è¯•ä»£ç ä¸æ—¥ä¿±å¢ï¼Œç„¶è€Œé¡¹ç›®çš„æ•´ä½“æ„å»ºé€Ÿåº¦é€šå¸¸éƒ½ä¼šä¸æ–­å˜æ…¢ã€‚å˜æ…¢çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚æœ‰ä¸å¯é¿å…çš„ç¼–è¯‘æ—¶é—´å¢é•¿ï¼Œä¹Ÿæœ‰å¯ä»¥æ”¹å–„çš„æµ‹è¯•è¿è¡Œæ–¹å¼ã€‚Gradle 5.x ç‰ˆæœ¬ä¸­å·²ç»åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ¯”å¦‚é»˜è®¤çš„incremental build\(å¢é‡ç¼–è¯‘\)å’Œbuild cache\(æ„å»ºç¼“å­˜\)ã€‚æ­¤å¤–ï¼Œç°åœ¨å¤§éƒ¨åˆ†ç”µè„‘éƒ½é…ç½®äº†å¤šæ ¸CPUï¼ŒGradleæä¾›äº†`--parallel` åŠŸèƒ½æ¥å¸®åŠ©ä½ åŸºäºå¤šæ ¸CPUå¹¶è¡Œè¿è¡ŒGradleçš„ä»»åŠ¡ã€‚æ¯”å¦‚ä½ çš„é¡¹ç›®é‡Œæœ‰ä¸‰ä¸ªæ— äº¤å‰ä¾èµ–Gradleå­æ¨¡å—ï¼Œå½“ä½ åœ¨ä¸€å°å…­æ ¸çš„æœºå™¨ä¸Šè·‘æ—¶ï¼Œä¸‰ä¸ªå­æ¨¡å—å¯ä»¥å¹¶è¡Œç¼–è¯‘å’Œè¿è¡Œæµ‹è¯•ï¼Œç†è®ºä¸Šä½ æœ€å¤šå¯ä»¥èŠ‚çœ2/3çš„æ„å»ºæ—¶é—´ã€‚

å¦‚æœä½ æƒ³æŠŠè¿™ä¸ªé€‰é¡¹ä½œä¸ºäººå’Œäººè·‘ä»»ä½•Gradleå‘½ä»¤æ—¶çš„é»˜è®¤é€‰é¡¹ï¼Œä½ å¯ä»¥åœ¨ä½ é¡¹ç›®æ ¹ç›®å½•çš„**gradle.properties** æ–‡ä»¶é‡Œæ·»åŠ ä¸‹é¢ä¸€è¡Œ

{% tabs %}
{% tab title="" %}
```java
org.gradle.parallel=true
```
{% endtab %}
{% endtabs %}

### --fail-fast

åœ¨CI\(æŒç»­é›†æˆ\)æ„å»ºé¡¹ç›®æ—¶ï¼Œå¿…ä¸å¯å°‘çš„ä¸€ä¸ªç¯èŠ‚æ˜¯è·‘è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ¯”å¦‚å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚å¤§å‹çš„é¡¹ç›®å¾€å¾€æœ‰æˆç™¾ä¸Šåƒä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¦‚æœCIç³»ç»Ÿæ²¡æœ‰å¾ˆå¥½çš„å¹¶è¡ŒåŒ–æœºåˆ¶çš„è¯ï¼Œ å…¨éƒ¨è·‘å®Œè‡³å°‘è¦ä¸ªäº”åˆ°ååˆ†é’Ÿï¼Œç”šè‡³æ›´ä¹…ã€‚ä¸‡ä¸€ä½ çš„åˆ†æ”¯é‡Œæœ‰æµ‹è¯•æŒ‚äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½ å¿…é¡»è¦ç­‰åˆ°æ‰€æœ‰æµ‹è¯•è·‘å®Œæ‰èƒ½å¾—åˆ°åé¦ˆï¼ˆæ¯”å¦‚æ”¶åˆ°æé†’ï¼‰ã€‚å‡è®¾é‚£ä¸ªæµ‹è¯•æ˜¯åœ¨ç¬¬äºŒåç§’æ—¶å°±æŒ‚äº†ï¼Œæ„å‘³ç€æˆ‘ä»¬æµªè´¹äº†ä¹‹åäº”åˆ°ååˆ†é’Ÿçš„æœºå™¨èµ„æºã€‚

`--fail-fast` æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œè®¾è®¡çš„ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¸€æ—¦æœ‰æµ‹è¯•æŒ‚æ‰å°±ç›´æ¥ç»ˆæ­¢ï¼Œè¿˜æ²¡è·‘çš„æµ‹è¯•å°±è¢«è·³è¿‡äº†ã€‚è¿™æ ·æˆ‘ä»¬çš„CIç¯å¢ƒèµ„æºåˆ©ç”¨ç‡å°±èƒ½æœ‰æ‰€æé«˜ï¼Œå¯¹äºé‚£ç§æœ‰æ•°åä¸ªç”šè‡³ä¸Šç™¾ä¸ªå·¥ç¨‹å¸ˆåœ¨åŒæ—¶å·¥ä½œçš„ä»£ç åº“ï¼Œ`--fail-fast`çš„ä¼˜åŒ–æ•ˆæœå°±å¾ˆæ˜æ˜¾äº†ã€‚

`--fail-fast` åªé€‚ç”¨äºGradle Testç±»åˆ«çš„æ„å»ºä»»åŠ¡ï¼Œæ¯”å¦‚ `./gradlew test --fail-fast`ã€‚ç”¨äºå…¶ä»–ä»»åŠ¡åˆ™ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚`./gradlew build --fail-fast`ï¼Œå› ä¸ºbuildä¸æ˜¯Testç±»åˆ«çš„ä»»åŠ¡ã€‚é™¤äº†ç”¨äºå‘½ä»¤è¡Œï¼Œä½ è¿˜å¯ä»¥åœ¨Gradleè„šæœ¬é‡Œè®¾ç½®ï¼š

```text
test {    failFast = true}
```

### -t, --continuous

`--continuous` å¸®åŠ©å¼€å‘è€…åœ¨æœ¬åœ°å¼€å‘æ—¶æ›´é«˜æ•ˆåœ°éªŒè¯ä»–ä»¬çš„changesã€‚æ¯”å¦‚ä½ åœ¨å†™ä¸€ä¸ªç±»çš„å•å…ƒæµ‹è¯•ï¼Œä½ å·²ç»æœ‰ä»¥ä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶

```java
# Foo.javapublic class Foo {    public int sum(int a, int b) {        return a + b;    }}# FooTest.javapublic class FooTest {    @Test    public void testSum() {        // TODO: implement me    }}
```

ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œè¿è¡Œ`./gradlew test --tests FooTest --continuous` æˆ–è€…ç¼©å‡ç‰ˆ`./gradlew test --tests FooTest -t`ï¼Œå½“ä½ æ”¹å˜`Foo.java`çš„å®ç°æˆ–è€…`FooTest.java`çš„æµ‹è¯•ä»£ç æ—¶ï¼ŒGradleä¼šæ£€æµ‹åˆ°æ–‡ä»¶å†…å®¹æ”¹å˜ï¼Œä»è€Œé‡æ–°ç¼–è¯‘è¿è¡Œä½ çš„æµ‹è¯•ï¼Œæ— éœ€ä½ äººå·¥æ‰§è¡ŒåŒæ ·çš„å‘½ä»¤ã€‚

è¿™ä¸ªåŠŸèƒ½éå¸¸é€‚åˆé‚£äº›éœ€è¦å¿«é€Ÿåé¦ˆã€è¿­ä»£ã€éªŒè¯ä¿®å¤çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ç¼–è¯‘ã€æµ‹è¯•ã€é‡æ„ã€ä»£ç é£æ ¼é”™è¯¯ä¿®å¤ç­‰ã€‚

### -x, --exclude-task

å½“ä½ æƒ³æ‰§è¡Œä¸€ç³»åˆ—Gradleæ„å»ºä»»åŠ¡ä½†åˆæƒ³è·³è¿‡æŸäº›å¾ˆæ…¢çš„æˆ–è€…æ˜¯ä¸ç›¸å…³çš„ä»»åŠ¡æ—¶ï¼Œ`-x`å°±æ´¾ä¸Šç”¨åœºäº†ã€‚æ¯”å¦‚Gradleæœ‰ä¸ªä»»åŠ¡å«`check`, å®ƒå¾€å¾€æ˜¯å¼€å‘è€…pushæœ¬åœ°commitså‰è·‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ªå¿«é€Ÿä»£ç æ­£ç¡®æ€§æ ¡éªŒçš„ç»¼åˆä»»åŠ¡ï¼ŒåŒ…å«ç¼–è¯‘ã€ä»£ç é™æ€åˆ†æã€è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰ã€‚å¦‚æœæ­¤æ—¶ä½ ä¸æƒ³è·‘é›†æˆæµ‹è¯•ï¼Œå› ä¸ºé›†æˆæµ‹è¯•å¾ˆæ…¢ï¼Œä½ å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œè·‘`./gradlew check -x integrationTest`, è¿™æ ·å®ƒå°±ä¼šè·‘é™¤äº†é›†æˆæµ‹è¯•ä¹‹å¤–çš„ç›¸å…³æ ¡éªŒä»»åŠ¡ã€‚

### -m, --dry-run

å½“ä½ ä¿®æ”¹äº†ä¸€äº›Gradleè„šæœ¬ï¼Œæˆ–è€…æƒ³å¿«é€ŸéªŒè¯ä½ çš„Gradleé…ç½®æ˜¯æ­£ç¡®çš„ï¼Œåˆç†åœ°åº”ç”¨`--dry-run`èƒ½å¸®ä½ èŠ‚çœä¸å°‘æ—¶é—´ã€‚æ¯”å¦‚ä½ æƒ³çœ‹çœ‹`check`ä»»åŠ¡åˆ°åº•ä¼šè·‘å“ªäº›ç›¸å…³ä»»åŠ¡æ—¶ï¼Œä½ å¯ä»¥ç”¨`./gradlew check -m`, ä¸å‡ºå‡ ç§’Gradleå°±ä¼šåœ¨å‘½ä»¤è¡Œæ‰“å°å‡ºéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åï¼ˆä½†ä¸æ‰§è¡Œï¼‰ã€‚

### --offline

è®¾æƒ³ä½ åœ¨ç«è½¦æˆ–è€…é£æœºä¸Šå¾ˆæ— èŠï¼Œçªç„¶çµå…‰ä¹ç°æƒ³åˆ°ä¸€ä¸ªä¼˜åŒ–ä½ ç°åœ¨ç³»ç»Ÿçš„æ–¹æ³•ï¼Œä½ è¿«ä¸åŠå¾…åœ°æ‰“å¼€ç¬”è®°æœ¬å•ªå•ªå•ªå•ªæ•²å®Œäº†ä»£ç ï¼Œç»“æœåœ¨å‘½ä»¤è¡Œä¸€è·‘GradleæŠ¥é”™è¯´æ²¡æœ‰ç½‘ç»œè¿æ¥ï¼Œæ— æ³•ä¸‹è½½ä¸€äº›é¡¹ç›®ä¾èµ–ã€‚å†æœ‰æ²¡æœ‰æ¯”è¿™ä¸ªæ›´è®©ä¸€ä¸ªå·¥ç¨‹å¸ˆç—›è‹¦çš„äº‹äº†å§ã€‚å…¶å®Gradleå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨æœ¬åœ°ç¼“å­˜äº†æ‰€æœ‰çš„é¡¹ç›®ä¾èµ–ï¼Œåªæ˜¯å®ƒä¹ æƒ¯æ€§åœ°ä¼šå»ç½‘ä¸Šé‡æ–°æ›´æ–°æ ¡å¯¹ä¸‹ä¾èµ–ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚æ­¤æ—¶`--offline`å°±èƒ½å¸®åŠ©ä½ å¼ºåˆ¶Gradleå¼€å¯ç¦»çº¿å·¥ä½œæ¨¡å¼!

### api / implementation / ~~compile~~

å¾ˆå¤šæ„å»ºç³»ç»Ÿéƒ½ä¼šç¢°åˆ°ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¦‚ä½•åˆç†è§£å†³**Transitive Dependency**ï¼ˆä¾èµ–ä¼ é€’\)? æ¯”æ–¹è¯´ç°åœ¨æœ‰å¦‚ä¸‹ä¾èµ–å…³ç³»`App -> Lib A -> Lib B`, å¦‚æœ_Lib B_ åªåœ¨_Lib A_çš„å‡½æ•°å†…éƒ¨ä½¿ç”¨åˆ°ï¼Œç†æƒ³çš„æƒ…å†µä¸‹_App_çš„ä»£ç æ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨_Lib B_çš„ï¼Œå› ä¸º_Lib B_åªæ˜¯_Lib A_çš„å†…éƒ¨å®ç°æ–¹å¼\(internal implementation\)ã€‚ ç„¶è€Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ ä¼šå‘ç°_App_çš„ä»£ç ç«Ÿç„¶èƒ½è°ƒç”¨_Lib B_ ğŸ˜±ğŸ¤”

ä»¥ä¸Šå°±æ˜¯åœ¨Gradleè„šæœ¬é‡Œä½¿ç”¨`compile`å…³é”®è¯çš„å‰¯ä½œç”¨ã€‚ä¸è¦ä»¥ä¸ºè¿™ä»…ä»…æ˜¯ä¸€ä¸ªå†…éƒ¨å®ç°æš´éœ²çš„é—®é¢˜ï¼Œå®ƒè¿˜ä¼šé€ æˆä¾èµ–ç‰ˆæœ¬è§£å†³å‡ºé”™å¯¼è‡´åº”ç”¨å±‚å‡ºé”™ï¼Œè¿˜ä¼šå‡æ…¢é¡¹ç›®ä»£ç çš„æ•´ä½“ç¼–è¯‘é€Ÿåº¦ã€‚

Gradleä»3.4ç‰ˆæœ¬èµ·å…¶å®å°±æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚å®ƒæŠŠ`compile`è¯­ä¹‰æ‹†åˆ†æˆä¸¤ç±»ï¼Œ`api`å’Œ`implementation`ã€‚`api`ç­‰ä»·äºè¢«_deprecated_çš„`compile`ã€‚è‡³äº`implementation`, ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºåŸºç¡€

```text
# build.gradle of Appdependencies {   api project('LibA')}# build.gradle of Lib Adependencies {   api project('models')   implementation 'com.google.guava:guava:18.0'}
```

è¿™æ ·_Guava:18_è¿™ä¸ªå†…éƒ¨ä¾èµ–å°±ä¸èƒ½æ¸—é€åˆ°_App_é‚£é‡Œã€‚å¦‚æœ_App_åˆšå¥½ä¹Ÿéœ€è¦ä½¿ç”¨_Guava_, å®ƒå°±éœ€è¦æ˜¾ç¤ºå®šä¹‰_Guava_ä¸ºå®ƒçš„ä¾èµ–ï¼Œè€Œä¸”å®ƒå¯ä»¥è‡ªç”±é€‰æ‹©_Guava_çš„ç‰ˆæœ¬è€Œä¸ç”¨æ‹…å¿ƒç‰ˆæœ¬è¯¯ç”¨æˆ–è€…å†²çªã€‚

**å‚è€ƒæ–‡ç« **

* [Improving the Performance of Gradle Builds](https://guides.gradle.org/performance/)

